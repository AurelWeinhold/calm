---
# This playbook prepares the servers for the bootstrap


- name: Setup to bootstrap
  hosts: baremetal

  tasks:
      - name: Install apt dependencies
        become: yes
        apt:
            update_cache: yes
            pkg:
                - python3
                - python3-pip
                - python3-dev
                - libffi-dev
                - gcc
                - libssl-dev

      - name: Create python virtual environment
        become: yes
        command:
            cmd: /usr/bin/python3 -m venv /opt/calm/calmenv
            creates: "/opt/calm/calmenv"

      - name: Uninstall docker-py
        pip:
            name: docker-py
            state: absent

      - name: Install pip dependencies
        pip:
            name: docker
            state: latest
